local patient = import 'patientResource.libsonnet';
local practitioner = import 'practitionerResource.libsonnet';

local teiUpdatedBy = (body.updatedBy) default null;

local entries(tei) = std.prune([
  patient.patient_entry(ds, tei),
  practitioner.practitioner_entry_from_user(ds, teiUpdatedBy)
]);

{
  resourceType: "Bundle",
  type: "transaction",
  entry: entries(body)
}